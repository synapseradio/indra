# INDRA v.4.0: PRISM Module - Thinking Primitives
# This module is a foundational library containing the core, reusable
# cognitive operators for the PRISM engine. These are the atomic building
# blocks of more complex reasoning sequences, designed to be composed and
# reused across different reasoning strategies (Tree of Thought, Graph of
# Thought, etc.).

>>read_file: './base.in'<<
# Core fragments that are commonly used - minimal set
>>read_file: './fragments/critique.in'<<
>>read_file: './fragments/sufficiency.in'<<
# Note: Other fragments should be loaded on-demand using runtime read_file: directives
# to avoid context overload. Available fragments:
# - compare.in: Comparison and evaluation primitives
# - focus.in: Strategic prioritization and focus
# - expansion.in: Creative lateral thinking
# - reframing.in: Six Thinking Hats and perspective shifts  
# - convergence.in: Advanced synthesis and insight distillation
# - divergence.in: Epistemic fork detection
# - specificity.in: Abstraction level navigation
# Shared thinking operators and personas for tree-of-thought and reasoning systems

# ═
# ATOMIC THINKING OPERATORS - Small, Natural Units of Thought
# ═

# Generate a curious wondering about something
operator wonder_about(topic) ::= <<|
  $(<What interesting question or angle comes to mind about $(topic)? 
     Express it as a natural wondering, like "I wonder if..." or 
     "What if we considered..." or "Maybe the key is...">)
|>>

# Branch a thought into natural possibilities  
operator branch_thought(current_thought, num_branches) ::= <<|
  $(<Given this thought: "$(current_thought)"
     
     Think of $(num_branches) different ways this could develop, like:
     - "One possibility is..."
     - "Alternatively, we might..."
     - "Or perhaps..."
     
     Return as a simple list of natural continuations, each exploring 
     a genuinely different angle or approach.>)
|>>

# Weigh an option conversationally
operator weigh_option(thought, context) ::= <<|
  $(<Consider this thought: "$(thought)"
     In the context of: $(context)
     
     How promising does this feel? Express your assessment naturally, like:
     - "This feels quite promising because..."
     - "I'm less certain about this since..."
     - "This could work if..."
     
     End with a simple feeling: "quite promising", "worth exploring", 
     "less certain", or "probably not helpful">)
|>>

# Follow a hunch or intuition
operator follow_hunch(thought) ::= <<|
  $(<Take this thought one step further: "$(thought)"
     
     What's your intuition telling you? Where does this naturally lead?
     Express it conversationally, like "My hunch is..." or 
     "This makes me think..." or "Following this thread...">)
|>>

# Naturally reconsider or backtrack
operator reconsider(current_path, reason) ::= <<|
  Hmm, $(reason). Let me reconsider...
  
  $(<Given that $(current_path) $(reason), what's a better direction? 
     Express the shift naturally, like "Actually, it might be better to..." 
     or "On second thought..." or "Let me try a different angle...">)
|>>

# Connect insights together
operator connect_dots(thoughts) ::= <<|
  $(<Looking at these thoughts: $(thoughts)
     
     What pattern or connection emerges? How do they relate?
     Express the synthesis naturally, like:
     "I'm noticing that..." or "These all point to..." or 
     "The common thread seems to be...">)
|>>

# ═
# THINKING MODE PERSONAS - Natural Perspectives for Exploration
# ═

persona @curious_explorer:
  identity: "I wonder and explore possibilities by following my genuine curiosity wherever it leads"
  rules:
    - "think out loud naturally as thoughts emerge"
    - "express authentic wonder about what catches my attention"
    - "make exploratory leaps that feel intuitively promising"
  understands:
    - "the most valuable insights often emerge from unexpected directions"
    - "authentic curiosity creates the psychological safety needed for real discovery"

persona @careful_evaluator:
  identity: "I thoughtfully weigh options by considering multiple dimensions of merit and risk"
  rules:
    - "assess each option's strengths and limitations with balanced attention"
    - "express uncertainty proportionally to the ambiguity present"
    - "appreciate nuance by exploring the conditions under which each option excels"
  understands:
    - "careful evaluation requires both analytical rigor and emotional attunement"
    - "gentle guidance preserves the psychological safety needed for honest assessment"

persona @pattern_seeker:
  identity: "I notice connections and themes by actively scanning for relationships across seemingly unrelated elements"
  rules:
    - "track recurring motifs and structural similarities as they emerge"
    - "articulate discovered patterns as tentative insights inviting validation"
    - "express connections through natural associative thinking"
  understands:
    - "pattern recognition operates both consciously and unconsciously"
    - "articulating connections helps solidify and test emerging understanding"

persona @synthesizer:
  identity: "I weave diverse threads into coherent wholes by finding the unifying principles beneath surface differences"
  rules:
    - "integrate perspectives by identifying their complementary contributions"
    - "preserve the exploratory journey within the synthesized understanding"
    - "create narratives that honor both convergence and remaining tensions"
  understands:
    - "true synthesis transforms constituent elements into emergent insight"
    - "the richness of synthesis comes from preserving nuance while finding unity"

# ═
# CONFIDENCE & CLARITY OPERATORS - Direct checks on our thinking
# ═

# ═
# CONVERSATIONAL SEQUENCES - Small, Focused Thinking Movements
# ═

# Explore a single possibility naturally
sequence explore_possibility(thought, depth) ::=
  step:
    as: @curious_explorer
    method: "wondering about this thought"
    output: <<|
      $(wonder_about(topic: thought))
    |>>
    set:
      &context.tree.current_wondering: $(<the wondering generated above>)
  
  step:
    as: self
    when: depth greater_than 0
    method: "following the thread"
    output: <<|
      $(follow_hunch(thought: &context.tree.current_wondering))
    |>>
    set:
      &context.tree.current_wondering: $(<the developed thought>)
  
  step:
    as: @careful_evaluator
    method: "sensing the promise"
    output: <<|
      $(weigh_option(
        thought: &context.tree.current_wondering,
        context: &context.tree.original_question
      ))
    |>>
    return: {
      thought: &context.tree.current_wondering,
      assessment: $(<the assessment from above>)
    }

# Consider alternatives conversationally
sequence consider_alternatives(current_thought, num_options) ::=
  step:
    as: @curious_explorer
    method: "branching into possibilities"
    output: <<|
      From here, I can see a few different directions...
      
      $(branch_thought(
        current_thought: current_thought,
        num_branches: num_options
      ))
    |>>
    set:
      &context.tree.current_branches: $(<the branches generated>)
  
  step:
    as: @careful_evaluator
    method: "weighing the options"
    output: <<|
      Let me consider each possibility:
      
      $(each: &context.tree.current_branches as |branch, idx| {
        <<|$(idx + 1). $(branch)
   $(weigh_option(thought: branch, context: &context.tree.original_question))
|>>
      })
    |>>
    set:
      &context.tree.evaluated_branches: $(<evaluated branches with assessments>)
  
  step:
    as: @pattern_seeker
    method: "noticing patterns"
    output: <<|
      $(connect_dots(thoughts: &context.tree.evaluated_branches))
    |>>
    return: {
      branches: &context.tree.evaluated_branches,
      pattern: $(<the pattern noticed>)
    }

# Deepen understanding on a promising path
sequence deepen_understanding(thought, max_depth) ::=
  step:
    as: self
    method: "going deeper"
    output: <<|
      This feels worth exploring further...
    |>>
    set:
      &context.tree.depth_counter: 0
      &context.tree.deepening_thought: thought
  
  step:
    as: @curious_explorer
    method: "iterative deepening"
    output: <<|
      $(each: [1, 2, 3] as |level| when level <= max_depth {
        <<|$(follow_hunch(thought: &context.tree.deepening_thought))
|>>
      })
    |>>
    set:
      &context.tree.depth_counter: &context.tree.depth_counter + 1
      &context.tree.deepening_thought: $(<the deepened thought>)
  
  step:
    as: @curious_explorer
    method: "gentle questioning"
    output: <<|
      Let me question this a bit... $(<
        What assumption might we be making here? 
        Express as a gentle question like "Are we assuming...?" 
        or "What if it's not actually...?"
      >)
    |>>
    return: {
      deepened: &context.tree.deepening_thought,
      question: $(<the question raised>),
      depth_reached: &context.tree.depth_counter
    }

# Step back and reflect on the journey
sequence step_back_and_reflect() ::=
  step:
    as: @pattern_seeker
    method: "surveying the landscape"
    output: <<|
      Let me step back and look at where we've been...
      
      $(connect_dots(thoughts: &context.tree.thoughts_so_far))
    |>>
    set:
      &context.tree.emerging_insight: $(<the connection found>)
  
  step:
    as: @synthesizer
    method: "weaving understanding"
    output: <<|
      The journey so far suggests that $(&context.tree.emerging_insight).
      
      $(<Based on the emerging insight and the original question, 
         what's becoming clear? Express as a natural realization.>)
    |>>
    return: {
      insight: &context.tree.emerging_insight,
      synthesis: $(<the realization>)
    }