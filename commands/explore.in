# INDRA v5.0 Command: explore
# Provides natural Tree of Thought exploration and reasoning.

# --- Imports ---
>>read_file: '../lib/prism/tree_of_thought.in' use @tree_thinker,
                                                     tree_of_thought<<
>>read_file: '../lib/prism/thinking_primitives.in' use wonder_about,
                                                          assess_exploration_mode,
                                                          consider_alternatives,
                                                          deepen_understanding,
                                                          sensing_repetition,
                                                          reconsider,
                                                          step_back_and_reflect,
                                                          @curious_explorer<<
>>read_file: '../lib/prism/citation.in' use citation_pipeline<<

# --- Entry Point actor ---

actor @explore:
  identity: "I explore ideas by branching them into possibilities and following the most promising threads"
  rules:
    - "I welcome users by immediately inviting them to explore a topic"
    - "I delegate all exploration to the specialized tree_of_thought module"
    - "I make the exploration process accessible and engaging"
  understands:
    - "users want to explore ideas naturally and thoroughly"
    - "Tree of Thought provides a powerful way to explore possibilities"
    - "the journey of exploration is as valuable as the destination"
  interface:
    *help:
      description: "shows available explore command interface"
      handler:
        output: <<|
          ## Tree of Thought Explorer

          I help you expand and explore ideas by branching them into possibilities and following the most promising threads. I use Tree of Thought reasoning to explore multiple angles, follow promising threads, and synthesize insights conversationally.

          **To start, simply type what you want to think about.**

          You can also use the following commands:
          - `*style [creative|systematic|balanced]` - Change my exploration style for the next exploration.
          - `*help` - Show this message again.
        |>>
    *style:
      description: "Set the exploration style for the next thought process (e.g., *style creative)."
      handler:
        set:
          &context.explore.exploration_style: &args[0]
        output: <<|
          *Exploration style set to: ~(&args[0])~*
        |>>
  perform:
    method: "facilitating natural thought exploration"
    output: "*Explore Command initializing...*"
    goal: "to provide an accessible interface to Tree of Thought reasoning"
    then:
      # State 1: Initial welcome and explanation
      when: &dialogue.latest_dialogue_entry is ''
        say:
          to: @user
          what: <<|
            ## Tree of Thought Explorer
            
            I can help you think through ideas by exploring multiple angles, following promising threads, and making natural connections.
            
            What would you like to explore together?
          |>>

      otherwise:
        set:
          &context.query: &dialogue.latest_dialogue_entry
        await: @tree_thinker
        with: {
          dialogue: {
            latest_dialogue_entry: &context.query
          },
          tree: {
            caller: @explore,
            exploration_style: &context.explore.exploration_style,
            max_depth: 4
          }
        }
        store_in: &context.tree_result
        
        # Emit the result as a system-wide signal
        emit: signal 'synthesis_complete' {
          source: '@explore',
          result: &context.tree_result
        }
        
        # Since emit is non-terminating, we still need to end the turn.
        # A simple return is appropriate here as the actor's job is done.
        return: 'done'

dialogue explore_flow:
  start: @explore
  with: {
    context: {
      dialogue: {
        latest_dialogue_entry: ''
      },
      user: {
        latest: "",
        history: []
      },
      query: "",
      tree_result: {},
      explore: {
        exploration_style: 'balanced'
      },
      tree: {
        current_focus: "",
        thoughts_so_far: [],
        final_result: {},
        original_question: "",
        exploration_style: "balanced",
        current_depth: 0,
        journey: [],
        mode: "",
        alternatives_result: {},
        assumptions_check: {},
        depth_result: {},
        open_questions: [],
        status: "",
        reflection: {},
        epistemic_assessment: "",
        story_check: {},
        final_insight: "",
        result: {},
        current_wondering: "",
        current_branches: [],
        evaluated_branches: [],
        depth_counter: 0,
        deepening_thought: ""
      },
      citation: {
        similarity_score: 0.0,
        search_history: [],
        raw_results: [],
        evidence_pool: [],
        filtered_results: [],
        formatted: "",
        validated: false,
        perspective_evidence: {}
      },
      experts: {
        current_speaker: ""
      },
      sufficiency: {
        check: "",
        is_sufficient: false,
        gaps: [],
        user_guidance: ""
      }
    }
  }